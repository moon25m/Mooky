# Render Blueprint for one-service deploy (React build + Express API + SSE)
# Docs: https://render.com/docs/blueprint-spec

services:
  - type: web
    name: mookyverse
    env: node
    plan: starter # fix: disks are not supported on the free plan
    branch: main
    region: oregon
    buildCommand: |
      npm ci --include=dev || npm i
      npm run build
    startCommand: node server/index.js
    healthCheckPath: /api/health
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: DISABLE_EMAIL
        value: "1"
      # Optional tuning for storage/rotation
      - key: WISHES_MAX
        value: "0"          # 0 = unlimited
      - key: WISHES_MAX_MB
        value: "1.5"
      - key: WISHES_BACKUP_KEEP
        value: "5"
      - key: REACT_APP_SURPRISE_URL
        value: "https://hbd-card.netlify.app/"
    disk:
      name: wishes-data
      mountPath: server/data
      sizeGB: 1
